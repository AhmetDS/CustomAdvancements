<?xml version="1.0" encoding="UTF-8"?>
<project name="CustomAdvancements" default="CreateJar" basedir="."
         xmlns:artifact="antlib:org.apache.maven.artifact.ant">

    <available property="maven.avail" classname="org.apache.maven.artifact.ant.DependenciesTask"/>

    <target name="init" unless="maven.avail">
        <mkdir dir="${user.home}/.ant/lib"/>
        <get dest="${user.home}/.ant/lib/maven-ant-tasks.jar"
             src="http://search.maven.org/remotecontent?filepath=org/apache/maven/maven-ant-tasks/2.1.3/maven-ant-tasks-2.1.3.jar"/>
        <fail message="Maven tasks installed, run build again"/>
    </target>

    <basename file="${basedir}" property="project.projectname"/>
    <property name="project.pluginsLocation" location="U:\Rowan\Desktop\Test servers\1.16.5\plugins"/>

    <target name="clean" description="Cleans project">
        <delete file="${project.pluginsLocation}\${project.projectname}.jar"/>
    </target>


    <target name="CreateJar" description="Create a jar for the project" depends="clean">
        <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="antlib:org.apache.maven.artifact.ant"/>
        <artifact:dependencies filesetId="runtime.fileset" useScope="runtime">
            <pom file="pom.xml"/>
        </artifact:dependencies>
        <jar destfile="${project.pluginsLocation}\${project.projectname}.jar">
            <fileset dir="${basedir}">
                <include name="**.yml"/>
            </fileset>
            <fileset dir="${basedir}\target\classes">
                <include name="**"/>
            </fileset>
            <fileset refid="runtime.fileset"/>
        </jar>
    </target>
</project>